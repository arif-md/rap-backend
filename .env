# =============================================================================
# RAP Local Development Environment Configuration
# =============================================================================
# This file is auto-generated by './dev.ps1 Setup' from .env.example
# Customize values as needed for your local environment

# -----------------------------------------------------------------------------
# Azure Container Registry (ACR) Configuration
# -----------------------------------------------------------------------------
# Your ACR login server - required for pulling pre-built images
# For local development, images are pulled from ACR
ACR_LOGIN_SERVER=ngraptordev.azurecr.io

# Service Image Versions
# Use commit SHA tags from ACR (run: az acr repository show-tags --name ngraptordev --repository raptor/frontend-dev)
# Update these with latest commit SHAs from your ACR
FRONTEND_VERSION=d6d464f3a171
BACKEND_VERSION=38b2eb8ec706
PROCESS_SERVICE_VERSION=latest

# -----------------------------------------------------------------------------
# Database Configuration (SQL Server)
# -----------------------------------------------------------------------------
DB_USERNAME=sa
DB_PASSWORD=YourStrong@Passw0rd

# -----------------------------------------------------------------------------
# Spring Security Configuration
# -----------------------------------------------------------------------------
SPRING_SECURITY_USER_NAME=admin
SPRING_SECURITY_USER_PASSWORD=admin123

# -----------------------------------------------------------------------------
# OIDC Authentication Configuration (Keycloak)
# -----------------------------------------------------------------------------
# SOLUTION: Custom OidcUserService (extracts user from ID Token only)
# -----------------------------------------------------------------------------
# Problem: Keycloak validates hostname consistency between token issuance and API calls
# - Browser flow: localhost:9090 (tokens issued with iss=http://localhost:9090)
# - Backend calls: host.docker.internal:9090 (container-to-host networking)
# - UserInfo endpoint: Keycloak rejects 401 due to hostname mismatch
#
# Solution: CustomOidcUserService extracts user data from ID Token claims
# - No UserInfo endpoint call needed
# - ID Token is already validated via JWK Set (cryptographic signature)
# - Works locally (mixed hostnames) AND Azure (unified public URL)
#
# Configuration:
# - issuer-uri: NOT used (prevents auto-discovery conflicts)
# - authorization-uri: Browser redirects (localhost:9090)
# - token-uri: Backend token exchange (host.docker.internal:9090)
# - user-info-uri: NOT CALLED (custom service bypasses it)
# - jwk-set-uri: Backend JWT validation (host.docker.internal:9090)
# -----------------------------------------------------------------------------

# OIDC Client Credentials
OIDC_CLIENT_ID=raptor-client
OIDC_CLIENT_SECRET=hS3DJ19E3mBUwo90AcusI0ICubISSpqz

# Authorization endpoint - Browser redirects (MUST be localhost for browser access)
OIDC_AUTHORIZATION_URI=http://localhost:9090/realms/raptor/protocol/openid-connect/auth

# Token endpoint - Backend server-to-server call
OIDC_TOKEN_URI=http://host.docker.internal:9090/realms/raptor/protocol/openid-connect/token

# UserInfo endpoint - NOT USED (CustomOidcUserService extracts from ID Token)
# Keeping configuration for potential future use
OIDC_USER_INFO_URI=http://host.docker.internal:9090/realms/raptor/protocol/openid-connect/userinfo

# JWK Set endpoint - Backend JWT signature validation
OIDC_JWK_SET_URI=http://host.docker.internal:9090/realms/raptor/protocol/openid-connect/certs

# Frontend URL for CORS and redirects
FRONTEND_URL=http://localhost:4200

# CORS allowed origins (comma-separated list)
# Add additional origins if needed (e.g., production frontend URL)
CORS_ALLOWED_ORIGINS=http://localhost:4200,http://localhost:3000

# Backend API URL for frontend to consume
# Use http://localhost:8080 for browser-based requests from host machine
API_BASE_URL=http://localhost:8080

# -----------------------------------------------------------------------------
# Keycloak Service Configuration
# -----------------------------------------------------------------------------
# Keycloak admin credentials (for accessing http://localhost:9090/admin)
KEYCLOAK_ADMIN=admin
KEYCLOAK_ADMIN_PASSWORD=admin

# Keycloak PostgreSQL database credentials
KEYCLOAK_DB_USER=keycloak
KEYCLOAK_DB_PASSWORD=keycloak

# -----------------------------------------------------------------------------
# Spring Profile
# -----------------------------------------------------------------------------
SPRING_PROFILES_ACTIVE=docker

# -----------------------------------------------------------------------------
# Application Port
# -----------------------------------------------------------------------------
APP_PORT=8080

# Logging (optional)
LOGGING_LEVEL_ROOT=INFO
LOGGING_LEVEL_BACKEND=DEBUG