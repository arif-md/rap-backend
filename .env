# =============================================================================
# RAP Local Development Environment Configuration
# =============================================================================
# This file is auto-generated by './dev.ps1 Setup' from .env.example
# Customize values as needed for your local environment

# -----------------------------------------------------------------------------
# Azure Container Registry (ACR) Configuration
# -----------------------------------------------------------------------------
# Your ACR login server - required for pulling pre-built images
# For local development, images are pulled from ACR
ACR_LOGIN_SERVER=ngraptordev.azurecr.io

# Service Image Versions
# Use commit SHA tags from ACR (run: az acr repository show-tags --name ngraptordev --repository raptor/frontend-dev)
# Update these with latest commit SHAs from your ACR
FRONTEND_VERSION=a9d557031e0c
BACKEND_VERSION=b4e0b8bf3909
PROCESS_SERVICE_VERSION=latest

# -----------------------------------------------------------------------------
# Database Configuration (SQL Server)
# -----------------------------------------------------------------------------
DB_USERNAME=sa
DB_PASSWORD=YourStrong@Passw0rd

# -----------------------------------------------------------------------------
# Spring Security Configuration
# -----------------------------------------------------------------------------
SPRING_SECURITY_USER_NAME=admin
SPRING_SECURITY_USER_PASSWORD=admin123

# -----------------------------------------------------------------------------
# OIDC Authentication Configuration (Keycloak)
# -----------------------------------------------------------------------------
# SOLUTION: Custom OidcUserService (extracts user from ID Token only)
# -----------------------------------------------------------------------------
# Problem: Keycloak validates hostname consistency between token issuance and API calls
# - Browser flow: localhost:9090 (tokens issued with iss=http://localhost:9090)
# - Backend calls: host.docker.internal:9090 (container-to-host networking)
# - UserInfo endpoint: Keycloak rejects 401 due to hostname mismatch
#
# Solution: CustomOidcUserService extracts user data from ID Token claims
# - No UserInfo endpoint call needed
# - ID Token is already validated via JWK Set (cryptographic signature)
# - Works locally (mixed hostnames) AND Azure (unified public URL)
#
# Configuration:
# - issuer-uri: NOT used (prevents auto-discovery conflicts)
# - authorization-uri: Browser redirects (localhost:9090)
# - token-uri: Backend token exchange (host.docker.internal:9090)
# - user-info-uri: NOT CALLED (custom service bypasses it)
# - jwk-set-uri: Backend JWT validation (host.docker.internal:9090)
# -----------------------------------------------------------------------------

# OIDC Client Credentials
OIDC_CLIENT_ID=raptor-client
OIDC_CLIENT_SECRET=l7svQm6SdAnRzXodWchQIS6KR9vJtzFK

# Authorization endpoint - Browser redirects (MUST be localhost for browser access)
OIDC_AUTHORIZATION_ENDPOINT=http://localhost:9090/realms/raptor/protocol/openid-connect/auth

# Token endpoint - Backend server-to-server call
OIDC_TOKEN_ENDPOINT=http://host.docker.internal:9090/realms/raptor/protocol/openid-connect/token

# UserInfo endpoint - NOT USED (CustomOidcUserService extracts from ID Token)
# Keeping configuration for potential future use
OIDC_USER_INFO_ENDPOINT=http://host.docker.internal:9090/realms/raptor/protocol/openid-connect/userinfo

# JWK Set endpoint - Backend JWT signature validation
OIDC_JWK_SET_URI=http://host.docker.internal:9090/realms/raptor/protocol/openid-connect/certs

# Frontend URL for CORS and redirects
FRONTEND_URL=http://localhost:4200

# CORS allowed origins (comma-separated list)
# Add additional origins if needed (e.g., production frontend URL)
CORS_ALLOWED_ORIGINS=http://localhost:4200,http://localhost:3000

# Backend API URL for frontend to consume
# Use http://localhost:8080 for browser-based requests from host machine
API_BASE_URL=http://localhost:8080

# -----------------------------------------------------------------------------
# Keycloak Service Configuration
# -----------------------------------------------------------------------------
# Keycloak admin credentials (for accessing http://localhost:9090/admin)
KEYCLOAK_ADMIN=admin
KEYCLOAK_ADMIN_PASSWORD=admin

# Keycloak PostgreSQL database credentials
KEYCLOAK_DB_USER=keycloak
KEYCLOAK_DB_PASSWORD=keycloak

# -----------------------------------------------------------------------------
# JWT Configuration (Your Application Tokens - Not OIDC Tokens)
# -----------------------------------------------------------------------------
# JWT Secret (Base64-encoded - generate with: openssl rand -base64 64)
# IMPORTANT: Use different secret in production (store in Azure Key Vault)
JWT_SECRET=dGhpc2lzYXZlcnlzZWN1cmVzZWNyZXRrZXl0aGF0c2hvdWxkYmVyZXBsYWNlZGluYXp1cmU=

# JWT Access Token Expiration (in minutes)
# NOTE: When SPRING_PROFILES_ACTIVE=local, this is OVERRIDDEN by application-local.properties
# Used for: Docker Compose (SPRING_PROFILES_ACTIVE=docker)
# NOT USED FOR: Azure deployment (Bicep controls via infra/main.bicep)
#JWT_ACCESS_TOKEN_EXPIRATION_MINUTES=2

# Refresh Token Expiration (in days)
# NOTE: When SPRING_PROFILES_ACTIVE=local, this is OVERRIDDEN by application-local.properties
# Used for: Docker Compose (SPRING_PROFILES_ACTIVE=docker)
# NOT USED FOR: Azure deployment (Bicep controls via infra/main.bicep)
JWT_REFRESH_TOKEN_EXPIRATION_DAYS=7

# -----------------------------------------------------------------------------
# Spring Profile
# -----------------------------------------------------------------------------
# Use 'local' for local development (loads application-local.properties)
# Use 'docker' when running in Docker Compose
SPRING_PROFILES_ACTIVE=local

# -----------------------------------------------------------------------------
# Application Port
# -----------------------------------------------------------------------------
APP_PORT=8080

# Logging (optional)
LOGGING_LEVEL_ROOT=INFO
LOGGING_LEVEL_BACKEND=DEBUG